<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Nhận Quà Xem Quảng Cáo & Quay Số</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f4f4f4;
      padding: 50px;
    }
    input, button {
      font-size: 18px;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    button {
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:disabled {
      background-color: gray;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
      color: #0033cc;
    }
  </style>
</head>
<body>
  <h1>🎁 Nhận Quà Xem Quảng Cáo và Quay Số 🎁</h1>

  <!-- Khu vực nhập tên ban đầu -->
  <div id="inputArea">
    <input type="text" id="playerName" placeholder="Tên Minecraft của bạn">
    <br>
    <button onclick="saveName()">Xác nhận Tên</button>
  </div>

  <!-- Khu vực game: hiển thị tên và nút quay -->
  <div id="gameArea" style="display:none;">
    <p><strong>Tên của bạn:</strong> <span id="displayName"></span></p>
    <button id="rollButton" onclick="watchAdAndRoll()">Quay Ngẫu Nhiên</button>
    <div id="status"></div>
  </div>

  <script>
    // Lưu tên người chơi và chuyển sang khu vực quay số
    function saveName() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) {
        alert("❗ Vui lòng nhập tên Minecraft.");
        return;
      }
      localStorage.setItem("playerName", name);
      showGameSection();
    }

    // Hiển thị khu vực game nếu đã có tên người chơi
    function showGameSection() {
      const name = localStorage.getItem("playerName");
      if (name) {
        document.getElementById("inputArea").style.display = "none";
        document.getElementById("gameArea").style.display = "block";
        document.getElementById("displayName").innerText = name;
      }
    }

    // Hàm thực hiện quá trình xem quảng cáo và quay số
    function watchAdAndRoll() {
      const playerName = localStorage.getItem("playerName");
      if (!playerName) return;
      
      // Mở quảng cáo (mỗi lần quay yêu cầu phải xem quảng cáo)
      window.open("https://favourableafter.com/a27wdsgvkg?key=a17d0d294dc6fb83b60c99ae9f8203d4", "_blank");
      
      const rollButton = document.getElementById("rollButton");
      rollButton.disabled = true;
      rollButton.innerText = "Đang xem quảng cáo...";
      
      document.getElementById("status").innerText = "⏳ Vui lòng chờ 15 giây...";

      // Sau 15 giây, sau khi quảng cáo "xem xong"...
      setTimeout(() => {
        // Thực hiện quay số với tỉ lệ trúng 1/20
        const randomNumber = Math.floor(Math.random() * 20);
        
        if (randomNumber === 0) {
          // THẮNG: Gửi thông tin qua webhook Discord
          document.getElementById("status").innerText = "✅ Chúc mừng, bạn đã trúng thưởng!";
          fetch("https://discord.com/api/webhooks/1378766894030393395/bPVZ8AMpX1woGC16YxW8j9OV4cpDtqA14P1etqjMtyfPCWL0YnDe61M6GqWgQEJBZc3i", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              content: `Người chơi **${playerName}** đã trúng thưởng`
            })
          })
          .then(() => {
            document.getElementById("status").innerText += " (Thông tin đã được gửi qua Discord.)";
          })
          .catch(() => {
            document.getElementById("status").innerText += " (Gửi qua Discord thất bại.)";
          });
        } else {
          // THUA: Thông báo không trúng thưởng
          document.getElementById("status").innerText = "❌ Rất tiếc, bạn không trúng thưởng. Hãy thử lại!";
        }

        // Cho phép quay lại
        rollButton.disabled = false;
        rollButton.innerText = "Quay Ngẫu Nhiên Lại";
      }, 15000);
    }

    // Kiểm tra nếu đã lưu tên trước đó để tự động hiện khu vực game
    window.onload = function() {
      showGameSection();
    };
  </script>
</body>
</html>
